<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Corteza Dashboard</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/styles/dashboard.css">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <h1>Dashboard</h1>
        <div style="display: flex; align-items: center; gap: 20px;">
          <button id="view-toggle-btn" class="view-toggle-btn chat-active">
            <span id="toggle-icon-chat">üí¨</span>
            <span id="toggle-text">Chat View</span>
            <span id="toggle-icon-classic" style="display: none;">üìä</span>
          </button>
          <div class="nav-links">
            <a href="/ai-analytics?workspace_id=<WORKSPACE_ID>">ü§ñ AI Analytics</a>
            <a href="/settings">‚öôÔ∏è Settings</a>
            <a href="/auth/logout">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Banner -->
  <div class="hero-banner">
    <div class="hero-content">
      <div class="hero-icon">üß†</div>
      <h1 class="hero-title">Team Memory Dashboard</h1>
      <p class="hero-subtitle">Your searchable knowledge base powered by AI</p>
      <div class="hero-stats-mini">
        <span class="hero-stat">
          <span class="stat-number" id="hero-total">-</span> memories
        </span>
        <span class="hero-stat-separator">‚Ä¢</span>
        <span class="hero-stat" id="hero-workspace-name">Loading...</span>
      </div>
      <button class="hero-cta-btn" onclick="openLogMemoryModal()">
        ‚ûï Log Team Memory
      </button>
    </div>
    <div class="hero-decoration"></div>
  </div>

  <div class="container">
    <!-- Stats for Classic View (8 cards) -->
    <div class="stats" id="stats-classic">
      <div class="stat-card"><h3>Total</h3><div class="number" id="total-count">-</div></div>
      <div class="stat-card"><h3>Decisions</h3><div class="number" id="decision-count">-</div></div>
      <div class="stat-card"><h3>Explanations</h3><div class="number" id="explanation-count">-</div></div>
      <div class="stat-card"><h3>Context</h3><div class="number" id="context-count">-</div></div>
      <div class="stat-card"><h3>Product</h3><div class="number" id="product-count">-</div></div>
      <div class="stat-card"><h3>UX</h3><div class="number" id="ux-count">-</div></div>
      <div class="stat-card"><h3>Technical</h3><div class="number" id="technical-count">-</div></div>
      <div class="stat-card"><h3>This Week</h3><div class="number" id="week-count">-</div></div>
    </div>

    <!-- Condensed Stats for Chat View (3 chips) -->
    <div class="stats-condensed" id="stats-chat" style="display: none;">
      <div class="stat-chip">
        <span class="stat-label">Total:</span>
        <span class="stat-value" id="total-count-chat">-</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">Decisions:</span>
        <span class="stat-value" id="decision-count-chat">-</span>
      </div>
      <div class="stat-chip">
        <span class="stat-label">This Week:</span>
        <span class="stat-value" id="week-count-chat">-</span>
      </div>
    </div>

    <!-- Chat View Container (New Primary Interface) -->
    <div id="chat-view-container" class="view-container" style="display: none;">
      <div class="chat-view-wrapper">
        <!-- Welcome Section -->
        <div class="chat-welcome">
          <div class="chat-welcome-icon">üí¨</div>
          <h2 class="chat-welcome-title">Ask About Your Team's Decisions</h2>
          <p class="chat-welcome-subtitle">Search your team memory using natural language</p>
        </div>

        <!-- Messages Area (Scrollable) -->
        <div class="chat-messages-area" id="chat-messages-main">
          <!-- Empty State -->
          <div class="chat-empty-state" id="chat-empty-state">
            <p class="empty-state-label">Try asking:</p>
            <div class="example-queries">
              <button class="example-query-btn" onclick="useSuggestionMain('Show me recent AEM decisions')">
                üí° "Show me recent AEM decisions"
              </button>
              <button class="example-query-btn" onclick="useSuggestionMain('What did we decide about performance?')">
                üöÄ "What did we decide about performance?"
              </button>
              <button class="example-query-btn" onclick="useSuggestionMain('Show technical decisions from this week')">
                üîß "Show technical decisions from this week"
              </button>
            </div>
          </div>
        </div>

        <!-- Input Area (Fixed at Bottom) -->
        <div class="chat-input-area-main">
          <input
            type="text"
            id="chat-input-main"
            class="chat-input-main"
            placeholder='Ask anything... e.g., "What decisions were made about authentication?"'
          />
          <button id="chat-send-main" class="chat-send-btn-main">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Classic View Container (Existing Table Interface) -->
    <div id="classic-view-container" class="view-container">
      <div class="filters">
        <div class="filter-group">
          <label>Search</label>
          <input type="text" id="search" placeholder="Search...">
        </div>
        <div class="filter-group">
          <label>Type</label>
          <select id="type-filter">
            <option value="">All Types</option>
            <option value="decision">Decision</option>
            <option value="explanation">Explanation</option>
            <option value="context">Context</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Category</label>
          <select id="category-filter">
            <option value="">All Categories</option>
            <option value="product">Product</option>
            <option value="ux">UX</option>
            <option value="technical">Technical</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Epic</label>
          <input type="text" id="epic-filter" placeholder="LOK-123">
        </div>
        <div class="filter-group" style="flex: 2; min-width: 400px;">
          <label>Date Range</label>
          <div class="date-presets">
            <button class="preset-btn" onclick="setDatePreset('today')">Today</button>
            <button class="preset-btn" onclick="setDatePreset('last7')">Last 7 days</button>
            <button class="preset-btn" onclick="setDatePreset('last30')">Last 30 days</button>
            <button class="preset-btn" onclick="setDatePreset('thisMonth')">This month</button>
            <button class="preset-btn" onclick="setDatePreset('lastMonth')">Last month</button>
            <button class="clear-dates-btn" onclick="clearDateFilter()">Clear</button>
          </div>
          <div class="date-inputs">
            <input type="date" id="date-from" placeholder="From">
            <input type="date" id="date-to" placeholder="To">
          </div>
        </div>
      </div>
      <button class="export-btn" onclick="exportToCSV()">üì• Export CSV</button>
      <div class="decisions-table">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Memory</th>
              <th>Type</th>
              <th>Category</th>
              <th>Epic</th>
              <th>Creator</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="decisions-body">
            <tr><td colspan="8" class="loading">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="footer-links">
        <a href="https://github.com/cristiantumani/corteza.app/blob/main/PRIVACY_POLICY.md" target="_blank">Privacy Policy</a>
        <span class="separator">‚Ä¢</span>
        <a href="https://github.com/cristiantumani/corteza.app/blob/main/TERMS_OF_SERVICE.md" target="_blank">Terms of Service</a>
        <span class="separator">‚Ä¢</span>
        <a href="mailto:cristiantumani@gmail.com">Contact Support</a>
      </div>
      <div class="footer-copyright">
        ¬© 2024 corteza.app. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="delete-modal">
    <div class="modal">
      <h2>üóëÔ∏è Delete Memory</h2>
      <p>Are you sure you want to delete memory <strong id="delete-decision-id">#0</strong>? This action cannot be undone.</p>
      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" onclick="closeDeleteModal()">Cancel</button>
        <button class="modal-btn modal-btn-delete" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Log Memory Modal -->
  <div class="modal-overlay" id="log-memory-modal">
    <div class="modal detail-modal">
      <div class="detail-header">
        <h2>‚ûï Log Team Memory</h2>
        <button class="close-btn" onclick="closeLogMemoryModal()">‚úï Close</button>
      </div>

      <div class="detail-section">
        <h3>What happened?</h3>
        <textarea
          id="log-memory-text"
          placeholder="Describe the decision, context, or explanation..."
          rows="5"
          style="width: 100%; padding: 12px; border: 1px solid #E1E4E8; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"
        ></textarea>
      </div>

      <div class="detail-grid">
        <div class="detail-item">
          <label>Type *</label>
          <select
            id="log-memory-type"
            style="width: 100%; padding: 10px; border: 1px solid #E1E4E8; border-radius: 8px; font-size: 14px;"
          >
            <option value="decision">Decision</option>
            <option value="explanation">Explanation</option>
            <option value="context">Context</option>
            <option value="learning">Learning</option>
            <option value="risk">Risk</option>
            <option value="assumption">Assumption</option>
          </select>
        </div>

        <div class="detail-item">
          <label>Category</label>
          <input
            type="text"
            id="log-memory-category"
            placeholder="e.g., Frontend, Backend, UX"
            style="width: 100%; padding: 10px; border: 1px solid #E1E4E8; border-radius: 8px; font-size: 14px;"
          />
        </div>

        <div class="detail-item">
          <label>Tags</label>
          <input
            type="text"
            id="log-memory-tags"
            placeholder="Comma-separated tags"
            style="width: 100%; padding: 10px; border: 1px solid #E1E4E8; border-radius: 8px; font-size: 14px;"
          />
        </div>

        <div class="detail-item">
          <label>Epic Key / Jira</label>
          <input
            type="text"
            id="log-memory-epic"
            placeholder="e.g., PROJ-123"
            style="width: 100%; padding: 10px; border: 1px solid #E1E4E8; border-radius: 8px; font-size: 14px;"
          />
        </div>
      </div>

      <div class="detail-section">
        <h3>Additional Context (Optional)</h3>
        <textarea
          id="log-memory-alternatives"
          placeholder="Any alternatives considered, additional details, or related information..."
          rows="3"
          style="width: 100%; padding: 12px; border: 1px solid #E1E4E8; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"
        ></textarea>
      </div>

      <div class="modal-buttons">
        <button class="modal-btn modal-btn-cancel" onclick="closeLogMemoryModal()">Cancel</button>
        <button class="modal-btn modal-btn-primary" onclick="submitLogMemory()">Save Memory</button>
      </div>
    </div>
  </div>

  <!-- Decision Detail Modal -->
  <div class="modal-overlay" id="detail-modal">
    <div class="modal detail-modal">
      <div class="detail-header">
        <h2 id="detail-title">Memory Details</h2>
        <div style="display: flex; gap: 10px;">
          <button class="edit-btn" onclick="openEditModal()">‚úèÔ∏è Edit</button>
          <button class="close-btn" onclick="closeDetailModal()">‚úï Close</button>
        </div>
      </div>

      <div class="detail-section">
        <h3>Content</h3>
        <div class="content" id="detail-decision-text"></div>
      </div>

      <div class="detail-grid">
        <div class="detail-item">
          <label>Type</label>
          <div class="value" id="detail-type"></div>
        </div>
        <div class="detail-item">
          <label>Creator</label>
          <div class="value" id="detail-creator"></div>
        </div>
        <div class="detail-item">
          <label>Date</label>
          <div class="value" id="detail-date"></div>
        </div>
        <div class="detail-item" id="detail-confidence-container" style="display: none;">
          <label>AI Confidence</label>
          <div class="value" id="detail-confidence"></div>
        </div>
      </div>

      <div class="detail-section" id="detail-meeting-section" style="display: none;">
        <h3>Meeting Context</h3>
        <div class="content" id="detail-meeting-info"></div>
      </div>

      <div class="detail-section" id="detail-epic-section" style="display: none;">
        <h3>Jira Epic</h3>
        <div class="content" id="detail-epic-info"></div>
      </div>

      <div class="detail-section" id="detail-tags-section" style="display: none;">
        <h3>Tags</h3>
        <div class="content" id="detail-tags"></div>
      </div>
    </div>
  </div>

  <!-- Edit Decision Modal -->
  <div class="modal-overlay" id="edit-modal">
    <div class="modal edit-modal">
      <div class="detail-header">
        <h2>‚úèÔ∏è Edit Memory</h2>
        <button class="close-btn" onclick="closeEditModal()">‚úï Cancel</button>
      </div>

      <form id="edit-form" onsubmit="saveEdit(event)">
        <input type="hidden" id="edit-decision-id">

        <div class="form-group">
          <label for="edit-decision-text">Content *</label>
          <textarea id="edit-decision-text" rows="4" required></textarea>
        </div>

        <div class="form-group">
          <label for="edit-decision-type">Type *</label>
          <select id="edit-decision-type" required>
            <option value="decision">Decision</option>
            <option value="explanation">Explanation</option>
            <option value="context">Context</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit-decision-category">Category (optional)</label>
          <select id="edit-decision-category">
            <option value="">None</option>
            <option value="product">Product</option>
            <option value="ux">UX</option>
            <option value="technical">Technical</option>
          </select>
          <small>Product, UX, or Technical domain</small>
        </div>

        <div class="form-group">
          <label for="edit-epic-key">Epic Key</label>
          <input type="text" id="edit-epic-key" placeholder="e.g. LOK-123">
          <small>Leave empty to remove epic link</small>
        </div>

        <div class="form-group">
          <label for="edit-tags">Tags</label>
          <input type="text" id="edit-tags" placeholder="tag1, tag2, tag3">
          <small>Comma-separated tags</small>
        </div>

        <div class="form-group">
          <label for="edit-alternatives">Additional Comments</label>
          <textarea id="edit-alternatives" rows="3"></textarea>
        </div>

        <div class="modal-buttons">
          <button type="button" class="modal-btn modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
          <button type="submit" class="modal-btn modal-btn-primary">üíæ Save Changes</button>
        </div>
      </form>
    </div>
  </div>


  <!-- Feedback Widget -->
  <div id="feedback-widget" class="feedback-widget">
    <button id="feedback-toggle" class="feedback-toggle">
      üí° Share Idea
    </button>
  </div>

  <!-- Feedback Modal -->
  <div class="modal-overlay" id="feedback-modal">
    <div class="modal feedback-modal">
      <div class="detail-header">
        <h2>üí° Share Your Feedback</h2>
        <button class="close-btn" onclick="closeFeedbackModal()">‚úï Close</button>
      </div>

      <form id="feedback-form" onsubmit="submitFeedback(event)">
        <div class="form-group">
          <label for="feedback-type">Type *</label>
          <select id="feedback-type" required>
            <option value="">Select type...</option>
            <option value="bug">üêõ Bug Report</option>
            <option value="feature">‚ú® Feature Request</option>
            <option value="general">üí¨ General Feedback</option>
          </select>
        </div>

        <div class="form-group">
          <label for="feedback-text">Your Feedback *</label>
          <textarea id="feedback-text" rows="6" required placeholder="Share your thoughts, ideas, or issues..."></textarea>
          <small>Be as detailed as possible. We read every submission!</small>
        </div>

        <div class="form-group">
          <label for="feedback-email">Your Email (optional)</label>
          <input type="email" id="feedback-email" placeholder="your@email.com">
          <small>If you'd like us to follow up with you</small>
        </div>

        <div class="modal-buttons">
          <button type="button" class="modal-btn modal-btn-cancel" onclick="closeFeedbackModal()">Cancel</button>
          <button type="submit" class="modal-btn modal-btn-primary" id="feedback-submit-btn">üì§ Send Feedback</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Semantic Search Chat Widget -->
  <div id="chat-widget" class="chat-widget">
    <div id="chat-toggle" class="chat-toggle">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    </div>

    <div id="chat-container" class="chat-container" style="display:none;">
      <div class="chat-header">
        <div>
          <h3>ü§ñ Ask about your decisions</h3>
          <p>Semantic search powered by AI</p>
          <p id="chat-workspace-info" style="font-size: 11px; opacity: 0.7; margin-top: 4px;"></p>
        </div>
        <button id="chat-close" class="chat-close-btn">√ó</button>
      </div>

      <div id="chat-messages" class="chat-messages"></div>

      <div class="chat-suggestions">
        <button class="suggestion-chip" onclick="useSuggestion('Show recent decisions')">Show recent decisions</button>
        <button class="suggestion-chip" onclick="useSuggestion('Search by product tag')">Search by tag</button>
        <button class="suggestion-chip" onclick="useSuggestion('What decisions were made this week?')">What's new this week?</button>
      </div>

      <div class="chat-input-container">
        <input
          type="text"
          id="chat-input"
          class="chat-input"
          placeholder='Try "show me AEM decisions" or "what did we decide about performance?"'
        />
        <button id="chat-send" class="chat-send-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script src="/scripts/dashboard.js"></script>
</body>
</html>
